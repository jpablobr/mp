#!/usr/bin/env bash

# focus command line completion.
# Copyright 2011 Jose Pablo Barrantes <xjpablobrx@gmail.com>
# Licensed under MIT

: ${have=$(command -v focus)}

test -n "$have" &&
_focus_complete() {
    COMPREPLY=()
    HOME=~
    if [ $COMP_CWORD = 1 ]; then
        notes=`focus -l | sed s:$HOME/.private/notes/::g | sed s:\.md::g`
        COMPREPLY=(`compgen -W "$notes" -- $2`)
    fi
    return 0
}

alias fcs='focus'
alias fcse='focus -e'
alias fcsl='focus -l'
alias fcsa='focus -a 5 &'

fcsk() {
    ps -ef           |
    grep [f]ocus     |
    awk '{print $2}' |
    cat              |
    while read pid; do kill -9 $pid; done
}

fcsr() {
    if [[ "$1" > 1 ]]; then
        local min="$1";shift
    else
        local min=5
    fi

    if [[ `ps -ef | grep [f]ocus` > 0 ]]; then
        fcsk
        focus -a "$min" &
    else
        focus -a "$min" &
    fi
}

test -n "$have" && complete -F _focus_complete -o default focus fcs fcse